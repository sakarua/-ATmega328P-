# 数码管显示与电机控制系统

这是一个基于 AVR 汇编语言的嵌入式控制系统项目。该项目实现了通过两个独立的 ADC 通道分别控制风扇转速和舵机角度，并实时在数码管上显示风扇控制电压值。

## 功能特性

1.  **双通道 ADC 控制**：
    *   **ADC4 (PC4)**：采集电压信号控制直流风扇的转速。
    *   **ADC5 (PC5)**：采集电压信号控制舵机的旋转角度。
2.  **实时电压显示**：
    *   使用 4 位数码管实时显示 ADC4 通道（风扇控制）的输入电压值（单位：mV）。
3.  **PWM 电机控制**：
    *   **风扇**：使用 Timer2 产生快速 PWM 信号，占空比随电压线性变化。
    *   **舵机**：使用 Timer1 产生 50Hz PWM 信号，脉宽随电压在 0.5ms - 2.5ms 之间变化。

## 硬件连接说明

### 输入设备
*   **风扇调速电位器**：连接至 **PC4 (ADC4)**
*   **舵机角度电位器**：连接至 **PC5 (ADC5)**

### 输出设备
*   **直流风扇 (PWM)**：连接至 **PB3 (OC2A)**
*   **舵机信号线 (PWM)**：连接至 **PB1 (OC1A)**
*   **4 位数码管**：
    *   **段选 (Segments)**：连接至 **PORTD** (PD0-PD7)
    *   **位选 (Digit Select)**：
        *   千位：**PC3**
        *   百位：**PC2**
        *   十位：**PC1**
        *   个位：**PC0**

## 软件逻辑

### 文件结构
*   `main.asm`: 主程序入口。包含中断向量表、初始化代码、主循环（负责数码管刷新）以及 ADC 中断服务程序（负责数据采集和电机控制）。
*   `functions.asm`: 包含功能子程序，如数学运算 (`Mul16x16_32`)、数码管扫描 (`Display_4Digits`)、风扇控制逻辑 (`Fans`) 等。
*   `def.inc`: 包含寄存器定义、常量定义和内存变量分配。

### 控制算法
1.  **风扇控制**：
    *   输入：0 - 5V (ADC 0 - 1023)
    *   输出：PWM 占空比 40 - 255 (映射关系：`PWM = 40 + (ADC >> 2) * 215 / 256`)
    *   效果：电压越高，风扇转速越快。

2.  **舵机控制**：
    *   输入：0 - 5V (ADC 0 - 1023)
    *   输出：PWM 脉宽计数 1000 - 5092 (对应 0.5ms - 2.5ms)
    *   效果：电压变化控制舵机在 0 - 180 度之间转动。

3.  **显示逻辑**：
    *   主循环不断刷新数码管，显示 ADC4 的电压换算值（ADC * 5000 / 1024 mV）。

## 编译与运行
*   使用 Microchip Studio (Atmel Studio) 打开 `.asmproj` 项目文件。
*   编译项目并烧录至 AVR 单片机（如 ATmega328P）。
*   确保系统时钟配置为 16MHz。
